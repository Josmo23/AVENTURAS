<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puertas M√°gicas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&display=swap" rel="stylesheet">
    <style>
  body {
        font-family: 'Baloo 2', cursive;
        background: linear-gradient(135deg, #00d4ff, #ff00aa);
        min-height: 100vh;
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
    }
    
    @keyframes gradient {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    
    .door {
        transition: all 0.4s ease;
        transform-style: preserve-3d;
        perspective: 1000px;
        border: 8px solid #fff;
        overflow: hidden;
    }
    
    .door:hover, .door:active {
        transform: scale(1.05) rotate(2deg);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
    }
    
    .door-front {
        height: 100%;
        width: 100%;
        position: absolute;
        backface-visibility: hidden;
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.3);
        background-image: linear-gradient(rgba(255,255,255,0.1), rgba(0,0,0,0.2));
    }
    
    .door-knob {
        width: 24px;
        height: 24px;
        background: #ffd700;
        border-radius: 50%;
        margin-right: -70px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        border: 2px solid #fff;
    }
    
    .confetti {
        position: fixed;
        width: 15px;
        height: 15px;
        background-color: #f00;
        animation: confetti-fall 3s ease-in-out forwards;
        z-index: 100;
        border-radius: 2px;
    }
    
    @keyframes confetti-fall {
        0% {
            transform: translateY(-100px) rotate(0deg);
            opacity: 1;
        }
        100% {
            transform: translateY(100vh) rotate(720deg);
            opacity: 0;
        }
    }
    
    .modal {
        animation: fadeIn 0.4s ease-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
    }
    
    .prize-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        animation: bounce 1s infinite alternate;
    }
    
    @keyframes bounce {
        from { transform: translateY(0); }
        to { transform: translateY(-10px); }
    }
    
    .beach-decoration {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 60px;
        background: #f8e9a1;
        z-index: -1;
    }
    
    .palm-tree {
        position: absolute;
        font-size: 3rem;
        animation: sway 3s ease-in-out infinite alternate;
        z-index: -1; /* Move palm trees behind content */
    }
    
    @keyframes sway {
        from { transform: rotate(-5deg); }
        to { transform: rotate(5deg); }
    }
    
    .wave {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 80px;
        background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120' preserveAspectRatio='none'%3E%3Cpath d='M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z' fill='%2300d4ff' opacity='.25'%3E%3C/path%3E%3Cpath d='M0,0V15.81C13,36.92,27.64,56.86,47.69,72.05,99.41,111.27,165,111,224.58,91.58c31.15-10.15,60.09-26.07,89.67-39.8,40.92-19,84.73-46,130.83-49.67,36.26-2.85,70.9,9.42,98.6,31.56,31.77,25.39,62.32,62,103.63,73,40.44,10.79,81.35-6.69,119.13-24.28s75.16-39,116.92-43.05c59.73-5.85,113.28,22.88,168.9,38.84,30.2,8.66,59,6.17,87.09-7.5,22.43-10.89,48-26.93,60.65-49.24V0Z' fill='%2300d4ff' opacity='.5'%3E%3C/path%3E%3Cpath d='M0,0V5.63C149.93,59,314.09,71.32,475.83,42.57c43-7.64,84.23-20.12,127.61-26.46,59-8.63,112.48,12.24,165.56,35.4C827.93,77.22,886,95.24,951.2,90c86.53-7,172.46-45.71,248.8-84.81V0Z' fill='%2300d4ff' opacity='.75'%3E%3C/path%3E%3C/svg%3E");
        background-size: cover;
        background-repeat: no-repeat;
        z-index: -1;
    }
    
    .game-title {
        text-shadow: 3px 3px 0 #ff00aa, 6px 6px 0 rgba(0,0,0,0.2);
        letter-spacing: 1px;
    }
    
    .door-emoji {
        font-size: 3rem;
        margin-bottom: 1rem;
        filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.3));
    }
    
    .login-screen {
        animation: fadeIn 0.6s ease-out;
    }
    
    .code-input {
        letter-spacing: 8px;
        font-size: 24px;
        text-align: center;
    }
    
    .key-button {
        transition: all 0.2s;
    }
    
    .key-button:active {
        transform: scale(0.95);
        background-color: #3182ce;
    }
    
    .shake {
        animation: shake 0.5s;
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    
    .folio-number {
        font-family: 'Courier New', monospace;
        letter-spacing: 2px;
        font-weight: bold;
        background: #f8f8f8;
        border: 2px dashed #ff5733;
        padding: 8px 16px;
        border-radius: 8px;
        display: inline-block;
        margin: 10px 0;
        box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    
    .lost-money {
        color: #e53e3e;
        font-weight: bold;
        animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.7; }
        100% { opacity: 1; }
    }
    
    /* Mobile optimizations */
    @media (max-width: 640px) {
        .door {
            height: 200px !important;
        }
        
        .door-emoji {
            font-size: 2.5rem;
        }
        
        .game-title {
            font-size: 2rem !important;
        }
        
        .palm-tree {
            font-size: 2rem;
        }
        
        .company-name {
            font-size: 1.2rem !important;
        }
    }
    
    /* Vibrant button styles */
    .vibrant-button {
        background: linear-gradient(135deg, #ff00aa, #00d4ff);
        color: white;
        font-weight: bold;
        border-radius: 12px;
        padding: 12px 24px;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        border: none;
        outline: none;
    }
    
    .vibrant-button:hover, .vibrant-button:focus {
        background: linear-gradient(135deg, #ff00dd, #00a0ff);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
    }
    
    .vibrant-button:active {
        transform: translateY(1px);
    }
    
    /* Vibrant input styles */
    .vibrant-input {
        border: 3px solid #ff00aa;
        border-radius: 12px;
        padding: 12px 16px;
        transition: all 0.3s;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        background-color: rgba(255, 255, 255, 0.9);
    }
    
    .vibrant-input:focus {
        border-color: #00d4ff;
        box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        outline: none;
    }
    
    /* Vibrant keypad */
    .vibrant-keypad button {
        background: linear-gradient(135deg, #ff00aa, #ff6a00);
        color: white;
        font-weight: bold;
        border-radius: 12px;
        transition: all 0.2s;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }
    
    .vibrant-keypad button:hover, .vibrant-keypad button:focus {
        background: linear-gradient(135deg, #ff00dd, #ff8c00);
        transform: translateY(-2px);
    }
    
    .vibrant-keypad button:active {
        transform: translateY(1px);
    }
    
    /* Player info in modal */
    .player-info-bar {
        background: linear-gradient(135deg, #6a11cb, #2575fc);
        color: white;
        border-radius: 8px;
        padding: 10px;
        margin-bottom: 15px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        animation: fadeIn 0.5s ease-out;
    }
    
    .player-info-label {
        font-weight: bold;
        color: rgba(255,255,255,0.8);
    }
    
    .player-info-value {
        font-weight: bold;
    }
    
    /* Catafixia styles */
    .catafixia-container {
        background: linear-gradient(135deg, #ff9900, #ff3300);
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border: 5px solid #ffcc00;
        position: relative;
        overflow: hidden;
    }
    
    .catafixia-title {
        text-shadow: 2px 2px 0 #ff3300, 4px 4px 0 rgba(0,0,0,0.2);
        color: #ffcc00;
    }
    
    .catafixia-icon {
        font-size: 3rem;
        animation: spin 4s linear infinite;
        display: inline-block;
    }
    
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    .prize-amount {
        font-size: 1.5rem;
        font-weight: bold;
        color: #ffcc00;
        text-shadow: 1px 1px 0 #000;
        background: rgba(0,0,0,0.2);
        padding: 5px 10px;
        border-radius: 8px;
        display: inline-block;
    }
    
    .mega-prize {
        animation: glow 2s infinite alternate;
        color: #ffcc00;
        font-weight: bold;
        text-shadow: 0 0 10px #ff9900, 0 0 20px #ff6600;
    }
    
    @keyframes glow {
        from { text-shadow: 0 0 10px #ff9900, 0 0 20px #ff6600; }
        to { text-shadow: 0 0 15px #ff9900, 0 0 30px #ff6600, 0 0 40px #ff3300; }
    }
    
    /* Company name styles - SMALLER SIZE */
    .company-name {
        font-size: 1.5rem; /* Reduced from 2rem */
        font-weight: bold;
        background: linear-gradient(to right, #ff9900, #ff3300);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        letter-spacing: 1px;
    }
    
    /* Disclaimer styles */
    .disclaimer {
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        font-size: 0.9rem;
        color: #555;
        text-align: center;
        border-left: 4px solid #ff00aa;
    }
</style>
<!-- Login Screen - Password -->
<div id="login-screen-password" class="login-screen w-full max-w-md bg-white bg-opacity-95 rounded-xl p-6 shadow-2xl relative overflow-hidden">
    <!-- Palm trees repositioned to not overlap with text -->
    <div class="absolute top-2 left-0 palm-tree">üå¥</div>
    <div class="absolute top-2 right-0 palm-tree">üå¥</div>
    
    <div class="text-center mb-2 mt-8">
        <span class="company-name">TOURS AVENTURAS POR LA BAJA</span>
    </div>
    
    <h1 class="text-4xl font-bold text-center mb-6 text-blue-600 game-title">üèùÔ∏è Puertas M√°gicas üèùÔ∏è</h1>
    
    <div class="mb-6 text-center">
        <p class="text-lg mb-2 font-bold text-purple-700">Ingresa el c√≥digo para comenzar:</p>
        <input type="password" id="code-input" class="code-input w-full p-4 vibrant-input mb-4" maxlength="8" readonly>
        
        <div class="grid grid-cols-3 gap-2 mb-4 vibrant-keypad">
            <button class="key-button text-2xl font-bold p-4 rounded-lg shadow-md">1</button>
            <button class="key-button text-2xl font-bold p-4 rounded-lg shadow-md">2</button>
            <button class="key-button text-2xl font-bold p-4 rounded-lg shadow-md">3</button>
            <button class="key-button text-2xl font-bold p-4 rounded-lg shadow-md">4</button>
            <button class="key-button text-2xl font-bold p-4 rounded-lg shadow-md">5</button>
            <button class="key-button text-2xl font-bold p-4 rounded-lg shadow-md">6</button>
            <button class="key-button text-2xl font-bold p-4 rounded-lg shadow-md">7</button>
            <button class="key-button text-2xl font-bold p-4 rounded-lg shadow-md">8</button>
            <button class="key-button text-2xl font-bold p-4 rounded-lg shadow-md">9</button>
            <button class="key-button text-2xl font-bold p-4 rounded-lg shadow-md">0</button>
            <button id="submit-code" class="col-span-1 bg-gradient-to-r from-green-500 to-green-600 text-xl font-bold p-4 rounded-lg shadow-md">‚úì</button>
            <button id="clear-code" class="col-span-1 bg-gradient-to-r from-red-500 to-red-600 text-xl font-bold p-4 rounded-lg shadow-md">‚å´</button>
        </div>
        
        <p id="login-message" class="text-red-500 font-medium hidden">C√≥digo incorrecto. Intenta de nuevo.</p>
    </div>
</div>

<!-- Login Screen - User Info -->
<div id="login-screen-info" class="hidden login-screen w-full max-w-md bg-white bg-opacity-95 rounded-xl p-6 shadow-2xl relative overflow-hidden">
    <!-- Palm trees repositioned to not overlap with text -->
    <div class="absolute top-2 left-0 palm-tree">üå¥</div>
    <div class="absolute top-2 right-0 palm-tree">üå¥</div>
    
    <div class="text-center mb-2 mt-8">
        <span class="company-name">TOURS AVENTURAS POR LA BAJA</span>
    </div>
    
    <h1 class="text-4xl font-bold text-center mb-6 text-blue-600 game-title">üèùÔ∏è Puertas M√°gicas üèùÔ∏è</h1>
    
    <div class="mb-6">
        <p class="text-lg mb-4 font-bold text-center text-purple-700">¬°C√≥digo correcto! Completa tus datos:</p>
        
        <div class="mb-4">
            <label for="user-name" class="block text-lg font-medium text-gray-700 mb-2">Nombre completo:</label>
            <input type="text" id="user-name" class="w-full p-4 vibrant-input" placeholder="Escribe tu nombre aqu√≠">
        </div>
        
        <div class="mb-6">
            <label for="user-phone" class="block text-lg font-medium text-gray-700 mb-2">N√∫mero de tel√©fono:</label>
            <input type="tel" id="user-phone" class="w-full p-4 vibrant-input" placeholder="Ej: 123-456-7890">
        </div>
        
        <button id="submit-info" class="w-full vibrant-button text-xl py-4">
            ¬°Comenzar Juego! üéÆ
        </button>
        
        <p id="info-message" class="text-red-500 font-medium mt-3 hidden">Por favor completa todos los campos.</p>
    </div>
</div>

<!-- Game Screen (Initially Hidden) -->
<div id="game-container" class="hidden w-full max-w-4xl bg-white bg-opacity-90 rounded-xl p-6 shadow-2xl relative overflow-hidden">
    <!-- Palm trees repositioned to not overlap with text -->
    <div class="absolute top-2 left-0 palm-tree">üå¥</div>
    <div class="absolute top-2 right-0 palm-tree">üå¥</div>
    
    <div class="text-center mb-2 mt-8">
        <span class="company-name">TOURS AVENTURAS POR LA BAJA</span>
    </div>
    
    <h1 class="text-4xl font-bold text-center mb-4 text-blue-600 game-title">üèùÔ∏è Puertas M√°gicas üèùÔ∏è</h1>
    <p class="text-center text-lg mb-6">¬°Abre puertas, gana premios y descubre la magia!</p>
    
    <div id="user-info-display" class="mb-4 p-3 bg-gradient-to-r from-purple-400 to-pink-500 rounded-lg text-white shadow-lg">
        <p class="text-center font-medium">Jugador: <span id="display-name">Nombre</span> | Tel: <span id="display-phone">Tel√©fono</span></p>
    </div>
    
    <div id="stats" class="flex justify-between mb-6 p-4 bg-gradient-to-r from-yellow-300 to-orange-500 rounded-lg shadow-lg">
        <div class="text-xl font-semibold flex items-center">
            <span class="mr-2">üèÜ</span> Nivel: <span id="level" class="ml-1 text-2xl">1</span>/5
        </div>
        <div class="text-xl font-semibold flex items-center">
            <span class="mr-2">üí∞</span> Ganancia: <span id="money" class="ml-1 text-2xl">0</span> pesos
        </div>
    </div>
    
    <div id="message" class="text-center mb-6 text-xl font-medium text-white bg-gradient-to-r from-blue-500 to-purple-600 p-4 rounded-lg shadow-md">
        <span class="mr-2">üö™</span> Elige una puerta para ganar 20 pesos. ¬°La aventura te espera!
    </div>
    
    <div id="doors-container" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <!-- Doors will be generated here -->
    </div>
    
    <div id="final-prize" class="hidden text-center p-5 bg-gradient-to-r from-yellow-300 to-yellow-500 rounded-lg mb-6 shadow-lg">
        <div class="flex justify-center space-x-4 mb-2">
            <span class="text-3xl">üéÅ</span>
            <span class="text-3xl">üèÜ</span>
            <span class="text-3xl">üéâ</span>
        </div>
        <p class="text-xl font-semibold">¬°√öltima ronda! Si ganas, recibir√°s un premio especial:</p>
        <p class="text-2xl font-bold text-red-600 mt-2">¬°Un premio sorpresa te espera!</p>
    </div>
    
    <!-- Catafixia Container -->
    <div id="catafixia-container" class="hidden catafixia-container mb-6 text-center">
        <h3 class="text-3xl font-bold mb-3 catafixia-title">¬°CATAFIXIA! <span class="catafixia-icon">üé∞</span></h3>
        <p class="text-xl text-white mb-4">¬øTe atreves a arriesgar todo por el GRAN PREMIO?</p>
        <div class="mb-4">
            <p class="text-lg text-white mb-2">Si aceptas, podr√≠as ganar:</p>
            <p class="mega-prize text-2xl mb-3">üèÜ VIAJE GRATIS A RUTA DEL VINO üèÜ</p>
        </div>
        <div class="flex justify-center space-x-4">
            <button id="reject-catafixia" class="bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-700 hover:to-gray-900 text-white font-bold py-3 px-6 rounded-lg transition duration-300 shadow-md">
                No, gracias
            </button>
            <button id="accept-catafixia" class="vibrant-button py-3 px-6">
                ¬°Acepto el reto!
            </button>
        </div>
    </div>
    
    <button id="restart-button" class="hidden mx-auto block vibrant-button text-xl py-3 px-8">
        üîÑ Jugar de nuevo
    </button>
    
    <!-- Disclaimer -->
    <div class="disclaimer mt-8">
        <p>Este juego es con fin recreativo. El uso del mismo as√≠ como participaci√≥n en la din√°mica se deja a discreci√≥n del cliente final. Todos los derechos reservados para ToursAventurasPorLaBaja.</p>
    </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmation-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
    <div class="modal bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-2xl border-4 border-yellow-400">
        <h3 class="text-2xl font-bold text-center mb-4 text-blue-600">¬øEst√°s seguro? ü§î</h3>
        <p class="text-center mb-6 text-lg">Si pierdes, perder√°s todo lo que has ganado hasta ahora.</p>
        <div class="flex flex-wrap justify-center gap-4">
            <button id="cancel-choice" class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 shadow-md">
                ‚ùå Cancelar
            </button>
            <button id="confirm-choice" class="vibrant-button py-3 px-6">
                ‚úÖ Confirmar
            </button>
        </div>
    </div>
</div>

<!-- Result Modal -->
<div id="result-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
    <div class="modal bg-white rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl border-4 border-yellow-400">
        <!-- Company name in modal - smaller size -->
        <div class="text-center mb-3">
            <span class="company-name text-lg">TOURS AVENTURAS POR LA BAJA</span>
        </div>
        
        <!-- Player info bar (always visible) -->
        <div class="player-info-bar">
            <div class="flex justify-between items-center">
                <div>
                    <span class="player-info-label">Jugador:</span> 
                    <span id="result-player-name" class="player-info-value">Nombre</span>
                </div>
                <div>
                    <span class="player-info-label">Tel:</span> 
                    <span id="result-player-phone" class="player-info-value">Tel√©fono</span>
                </div>
            </div>
        </div>
        
        <div id="result-icon" class="prize-icon text-center">üéâ</div>
        <h3 id="result-title" class="text-3xl font-bold mb-4 text-center">¬°Felicidades!</h3>
        <p id="result-message" class="text-xl mb-3 text-center">Has ganado 20 pesos.</p>
        
        <!-- Loss details (hidden by default) -->
        <div id="loss-details" class="hidden">
            <p class="text-xl mb-2 text-center lost-money">¬°Has perdido todo tu dinero!</p>
            <div class="text-center mb-4">
                <p class="text-lg mb-1">Folio de transacci√≥n:</p>
                <div id="folio-number" class="folio-number">12345</div>
            </div>
        </div>
        
        <button id="continue-button" class="w-full vibrant-button py-3 px-6 text-xl">
            Continuar üöÄ
        </button>
    </div>
</div>

<script>
    // Game state
    const gameState = {
        level: 1,
        money: 0,
        selectedDoorIndex: null,
        doorColors: [
            '#FF5733', // Sunset orange
            '#33A8FF', // Ocean blue
            '#FF9F33', // Sand yellow
            '#33FFB8', // Tropical green
            '#FF33A8', // Vibrant pink
            '#33FFF5'  // Turquoise
        ],
        doorEmojis: ['üèñÔ∏è', 'üåÆ', 'üåµ', 'üçπ', 'üê†', 'üèÑ‚Äç‚ôÇÔ∏è', 'üåä', 'üêö', 'üê¨'],
        winProbability: 0.40, // Updated to 40% chance to win
        catafixiaProbability: 0.02, // 2% chance to win the grand prize
        correctCode: '13062025',
        userName: '',
        userPhone: '',
        // New prize structure
        levelPrizes: [20, 30, 50, 0], // Level 4 prize is special (random)
        finalPrizes: ['Paseo en barco ‚õµ', 'Vino gratis üç∑', '50 pesos de descuento üí∞', 'Premio sorpresa üéÅ'],
        grandPrize: 'Viaje gratis a Ruta del Vino üçá',
        // Track accumulated winnings from first 3 levels
        accumulatedWinnings: 0
    };
    
    // DOM elements - Login screens
    const loginScreenPassword = document.getElementById('login-screen-password');
    const loginScreenInfo = document.getElementById('login-screen-info');
    const codeInput = document.getElementById('code-input');
    const submitCodeButton = document.getElementById('submit-code');
    const clearCodeButton = document.getElementById('clear-code');
    const loginMessage = document.getElementById('login-message');
    const keyButtons = document.querySelectorAll('.key-button');
    const userNameInput = document.getElementById('user-name');
    const userPhoneInput = document.getElementById('user-phone');
    const submitInfoButton = document.getElementById('submit-info');
    const infoMessage = document.getElementById('info-message');
    
    // DOM elements - Game
    const gameContainer = document.getElementById('game-container');
    const displayName = document.getElementById('display-name');
    const displayPhone = document.getElementById('display-phone');
    const doorsContainer = document.getElementById('doors-container');
    const levelDisplay = document.getElementById('level');
    const moneyDisplay = document.getElementById('money');
    const messageDisplay = document.getElementById('message');
    const finalPrizeDisplay = document.getElementById('final-prize');
    const catafixiaContainer = document.getElementById('catafixia-container');
    const acceptCatafixiaButton = document.getElementById('accept-catafixia');
    const rejectCatafixiaButton = document.getElementById('reject-catafixia');
    const restartButton = document.getElementById('restart-button');
    const confirmationModal = document.getElementById('confirmation-modal');
    const cancelChoiceButton = document.getElementById('cancel-choice');
    const confirmChoiceButton = document.getElementById('confirm-choice');
    const resultModal = document.getElementById('result-modal');
    const resultIcon = document.getElementById('result-icon');
    const resultTitle = document.getElementById('result-title');
    const resultMessage = document.getElementById('result-message');
    const resultPlayerName = document.getElementById('result-player-name');
    const resultPlayerPhone = document.getElementById('result-player-phone');
    const lossDetails = document.getElementById('loss-details');
    const folioNumber = document.getElementById('folio-number');
    const continueButton = document.getElementById('continue-button');
    
    // Generate random 5-digit folio number
    function generateFolioNumber() {
        return Math.floor(10000 + Math.random() * 90000).toString();
    }
    
    // Login functionality - Password
    keyButtons.forEach(button => {
        button.addEventListener('click', () => {
            const value = button.textContent;
            if (value.length === 1 && codeInput.value.length < 8) {
                codeInput.value += value;
            }
        });
    });
    
    clearCodeButton.addEventListener('click', () => {
        codeInput.value = codeInput.value.slice(0, -1);
    });
    
    submitCodeButton.addEventListener('click', () => {
        if (codeInput.value === gameState.correctCode) {
            loginScreenPassword.classList.add('hidden');
            loginScreenInfo.classList.remove('hidden');
        } else {
            loginMessage.classList.remove('hidden');
            codeInput.classList.add('shake');
            setTimeout(() => {
                codeInput.classList.remove('shake');
            }, 500);
            setTimeout(() => {
                codeInput.value = '';
                loginMessage.classList.add('hidden');
            }, 1500);
        }
    });
    
    // Login functionality - User Info
    submitInfoButton.addEventListener('click', () => {
        const name = userNameInput.value.trim();
        const phone = userPhoneInput.value.trim();
        
        if (name && phone) {
            gameState.userName = name;
            gameState.userPhone = phone;
            loginScreenInfo.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            displayName.textContent = name;
            displayPhone.textContent = phone;
            initGame();
        } else {
            infoMessage.classList.remove('hidden');
            setTimeout(() => {
                infoMessage.classList.add('hidden');
            }, 2000);
        }
    });
    
    // Initialize game
    function initGame() {
        gameState.level = 1;
        gameState.money = 0;
        gameState.accumulatedWinnings = 0; // Reset accumulated winnings
        updateDisplay();
        generateDoors();
        restartButton.classList.add('hidden');
        finalPrizeDisplay.classList.add('hidden');
        catafixiaContainer.classList.add('hidden');
    }
    
    // Update display
    function updateDisplay() {
        levelDisplay.textContent = gameState.level;
        moneyDisplay.textContent = gameState.money;
        
        if (gameState.level === 4) {
            finalPrizeDisplay.classList.remove('hidden');
            messageDisplay.innerHTML = "<span class='mr-2'>üéØ</span> ¬°√öltima ronda! Elige una puerta para ganar un premio especial.";
        } else if (gameState.level === 5) {
            // Catafixia level
            catafixiaContainer.classList.remove('hidden');
            messageDisplay.innerHTML = "<span class='mr-2'>üé∞</span> ¬°Nivel CATAFIXIA! Decide si quieres arriesgar todo por el gran premio.";
            doorsContainer.innerHTML = ''; // Hide doors in catafixia level
        } else {
            const currentPrize = gameState.levelPrizes[gameState.level - 1];
            messageDisplay.innerHTML = `<span class='mr-2'>üö™</span> Elige una puerta para ganar <span class="prize-amount">${currentPrize} pesos</span>. ¬°La aventura te espera!`;
        }
    }
    
    // Generate doors
    function generateDoors() {
        doorsContainer.innerHTML = '';
        
        // Don't show doors in catafixia level
        if (gameState.level === 5) return;
        
        // Shuffle colors and emojis
        const shuffledColors = [...gameState.doorColors].sort(() => Math.random() - 0.5);
        const shuffledEmojis = [...gameState.doorEmojis].sort(() => Math.random() - 0.5);
        
        // Create 3 doors
        for (let i = 0; i < 3; i++) {
            const door = document.createElement('div');
            door.className = 'door relative h-64 cursor-pointer rounded-xl';
            door.innerHTML = `
                <div class="door-front" style="background-color: ${shuffledColors[i]}">
                    <div class="text-white text-3xl font-bold mt-4 bg-black bg-opacity-30 px-4 py-2 rounded-lg">Puerta ${i + 1}</div>
                    <div class="door-emoji">${shuffledEmojis[i]}</div>
                    <div class="door-knob absolute right-4 top-1/2"></div>
                    <div class="text-white text-xl mb-4 bg-black bg-opacity-30 px-4 py-2 rounded-lg">¬øSuerte?</div>
                </div>
            `;
            door.addEventListener('click', () => selectDoor(i));
            doorsContainer.appendChild(door);
        }
    }
    
    // Select door
    function selectDoor(index) {
        gameState.selectedDoorIndex = index;
        showConfirmationModal();
    }
    
    // Show confirmation modal
    function showConfirmationModal() {
        confirmationModal.classList.remove('hidden');
    }
    
    // Hide confirmation modal
    function hideConfirmationModal() {
        confirmationModal.classList.add('hidden');
    }
    
    // Process door selection
    function processDoorSelection() {
        hideConfirmationModal();
        
        // Update player info in result modal
        resultPlayerName.textContent = gameState.userName;
        resultPlayerPhone.textContent = gameState.userPhone;
        
        // Determine if player wins (40% chance)
        const isWin = Math.random() < gameState.winProbability;
        
        if (isWin) {
            // Hide loss details
            lossDetails.classList.add('hidden');
            
            if (gameState.level === 4) {
                // Level 4 - Random special prize
                const randomPrizeIndex = Math.floor(Math.random() * gameState.finalPrizes.length);
                const randomPrize = gameState.finalPrizes[randomPrizeIndex];
                
                let prizeIcon = "üéÅ";
                if (randomPrize.includes("barco")) prizeIcon = "‚õµ";
                else if (randomPrize.includes("vino")) prizeIcon = "üç∑";
                else if (randomPrize.includes("descuento")) prizeIcon = "üí∞";
                
                showResult(true, "¬°PREMIO ESPECIAL! üéä", `Has ganado: ${randomPrize}`, prizeIcon);
                gameState.money += 50; // Add some money for the final level
            } else {
                // Regular win with updated prize amounts
                const currentPrize = gameState.levelPrizes[gameState.level - 1];
                gameState.money += currentPrize;
                
                // Track accumulated winnings from first 3 levels
                if (gameState.level <= 3) {
                    gameState.accumulatedWinnings += currentPrize;
                }
                
                showResult(true, "¬°GANASTE! üéâ", `Has ganado ${currentPrize} pesos. Total: ${gameState.money} pesos.`, "üèÜ");
            }
            createConfetti();
        } else {
            // Loss with encouraging message and folio number
            const newFolio = generateFolioNumber();
            folioNumber.textContent = newFolio;
            lossDetails.classList.remove('hidden');
            
            // If level 4, show how much they lost from previous levels
            if (gameState.level === 4) {
                showResult(false, "¬°Has perdido! üåä", `Has perdido los ${gameState.accumulatedWinnings} pesos que hab√≠as ganado. Explorar siempre ser√° para los valientes.`, "üß≠");
            } else {
                showResult(false, "¬°Has perdido! üåä", "Explorar siempre ser√° para los valientes. ¬°Int√©ntalo de nuevo!", "üß≠");
            }
            gameState.money = 0; // Reset money to 0 when player loses
        }
    }
    
    // Process catafixia choice
    function processCatafixiaChoice(accepted) {
        if (accepted) {
            // Player accepted the catafixia challenge
            const isWin = Math.random() < gameState.catafixiaProbability; // 2% chance
            
            if (isWin) {
                // Won the grand prize!
                showResult(true, "¬°INCRE√çBLE! üéäüéäüéä", `¬°Has ganado el GRAN PREMIO: ${gameState.grandPrize}!`, "üèÜ");
                createConfetti();
                // Create extra confetti for the grand prize
                setTimeout(() => {
                    createConfetti();
                }, 500);
            } else {
                // Lost everything
                const newFolio = generateFolioNumber();
                folioNumber.textContent = newFolio;
                lossDetails.classList.remove('hidden');
                
                showResult(false, "¬°Has perdido! üò¢", "La suerte no estuvo de tu lado esta vez. ¬°Gracias por jugar!", "üé∞");
                gameState.money = 0; // Reset money to 0 when player loses
            }
        } else {
            // Player rejected the catafixia challenge - they keep their winnings
            showResult(true, "¬°Decisi√≥n sabia! üëç", `Te quedas con tus ${gameState.money} pesos. ¬°Gracias por jugar!`, "üí∞");
        }
        
        // Hide catafixia container
        catafixiaContainer.classList.add('hidden');
    }
    
    // Show result modal
    function showResult(isWin, title, message, icon) {
        resultTitle.textContent = title;
        resultMessage.textContent = message;
        resultIcon.textContent = icon;
        
        if (isWin) {
            resultTitle.className = "text-3xl font-bold mb-4 text-center text-green-600";
        } else {
            resultTitle.className = "text-3xl font-bold mb-4 text-center text-red-600";
        }
        
        resultModal.classList.remove('hidden');
    }
    
    // Hide result modal
    function hideResultModal() {
        resultModal.classList.add('hidden');
    }
    
    // Continue game
    function continueGame() {
        hideResultModal();
        
        if (gameState.money === 0) {
            // Game over, show restart button
            restartButton.classList.remove('hidden');
            messageDisplay.innerHTML = "<span class='mr-2'>üîÑ</span> ¬°Juego terminado! Puedes volver a jugar.";
            doorsContainer.innerHTML = '';
            catafixiaContainer.classList.add('hidden');
            moneyDisplay.textContent = "0"; // Ensure money display shows 0
        } else {
            if (gameState.level < 5) {
                gameState.level++;
                updateDisplay();
                generateDoors();
            } else {
                // Game completed successfully
                messageDisplay.innerHTML = "<span class='mr-2'>üèÜ</span> ¬°Felicidades! Has completado el juego.";
                restartButton.classList.remove('hidden');
                doorsContainer.innerHTML = '';
                catafixiaContainer.classList.add('hidden');
            }
        }
    }
    
    // Create confetti effect
    function createConfetti() {
        const colors = ['#FF5733', '#33A8FF', '#FF9F33', '#33FFB8', '#FF33A8', '#33FFF5', '#FF00AA', '#00D4FF'];
        
        for (let i = 0; i < 100; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = `${Math.random() * 100}%`;
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.width = `${Math.random() * 12 + 8}px`;
            confetti.style.height = `${Math.random() * 12 + 8}px`;
            confetti.style.animationDuration = `${Math.random() * 3 + 2}s`;
            confetti.style.animationDelay = `${Math.random() * 0.5}s`;
            
            // Add some rotation
            confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
            
            // Different shapes
            if (Math.random() > 0.7) {
                confetti.style.borderRadius = '50%';
            } else if (Math.random() > 0.5) {
                confetti.style.borderRadius = '4px';
            }
            
            document.body.appendChild(confetti);
            
            // Remove confetti after animation
            setTimeout(() => {
                confetti.remove();
            }, 5000);
        }
    }
    
    // Format phone number as user types
    userPhoneInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 10) value = value.slice(0, 10);
        
        if (value.length > 6) {
            value = value.slice(0, 3) + '-' + value.slice(3, 6) + '-' + value.slice(6);
        } else if (value.length > 3) {
            value = value.slice(0, 3) + '-' + value.slice(3);
        }
        
        e.target.value = value;
    });
    
    // Event listeners
    cancelChoiceButton.addEventListener('click', hideConfirmationModal);
    confirmChoiceButton.addEventListener('click', processDoorSelection);
    continueButton.addEventListener('click', continueGame);
    restartButton.addEventListener('click', initGame);
    
    // Catafixia event listeners
    acceptCatafixiaButton.addEventListener('click', () => processCatafixiaChoice(true));
    rejectCatafixiaButton.addEventListener('click', () => processCatafixiaChoice(false));
</script>
</body>
</html>
